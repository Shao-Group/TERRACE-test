# Download Data 

The STAR alignments of a set of 10 simulated and 8 biological paired-end RNA-seq samples
are available at [doi:10.26208/AZ99-RQ38](https://doi.org/10.26208/AZ99-RQ38).
TERRACE usually take a few minutes to an hour to assemble a typical aligned RNA-seq sample.

# Run TERRACE

The usage of `TERRACE` is:
```
terrace -i <input.bam> -o <output.gtf> -fa <reference-genome.fa> --read_length <length-of-paired-end-reads> -r [reference_annotation.gtf] -fe [feature_file] [options]
```
The `input.bam` is the read alignment file.

The reconstructed circular transcripts shall be written as GTF format into `output.gtf`.

`reference-genome.fa` is the reference genome file in fasta format. 

`length-of-paired-end-reads` is the length of the reads used to produce the alignment file (100 for simulated data, 150 for biological data).

`reference_annotation.gtf` is the annotation file in GTF format. This parameter is optional.

`feature_file` is a csv file generated by TERRACE that contains circRNA features used in a machine learning model for assigning confidence scores. This parameter is optional.

We recommend to use [GRCh38 reference/annotation](https://ftp.ensembl.org/pub/release-97/gtf/homo_sapiens/Homo_sapiens.GRCh38.97.gtf.gz) for simulated data and [GRCh37 reference](https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_43/GRCh37_mapping/GRCh37.primary_assembly.genome.fa.gz),  [GRCh37 annotation](https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_43/GRCh37_mapping/gencode.v43lift37.basic.annotation.gtf.gz) for biological data to ensure reproducibility.

# Evaluate TERRACE

1. Download - Download the appropriate ground truth file to evaluate output.gtf produced by TERRACE. The ground truth files for simulated data can be downloaded from [doi:10.26208/AZ99-RQ38](https://doi.org/10.26208/AZ99-RQ38). The ground truth files for simulated data are already in the standard gtf format. Ignore step 2 if you are evaluating on the simulated data.

The ground truth files for the biological data can be downloaded from the isocirc catalog (https://genome.ucsc.edu/s/xinglab_chop/isoCirc). To download groud the truth file, got to the [Table Browser](https://genome.ucsc.edu/cgi-bin/hgTables?hgsid=1761281632_7eq71llIPltZklaNkDC972ZYv5N6&db=hg19&position=chr1:23356962-23380332&hgta_regionType=range), chosoe the appropriate `tissue` for the `track`, select `genome` for the `region` field, select output format as `GTF - gene transfer format (limited)`, and assign an `output filename` before clicking `get output`.  See step 2 to convert the biological ground truth to a standard gtf format adjusted for our evaluation pipeline.

2. Convert - (Ignore this step if you are evaluating on simulated data) Convert the biological ground truth file to a standard gtf file adjusted for our evaluation pipeline using the script `convert_isocirc_gtf.py` provided. The usage is:
    ```
    python3 convert_isocirc_gtf.py <dowloaded-ground-truth.gtf> <ground-truth-adjusted.gtf>
    ```

3. Sort - Sort both output.gtf and ground-truth.gtf using `sort_circ_gtf.py` script provided. The usage is:
    ```
    python3 sort_circ_gtf.py <input-file.gtf> <input-file-sorted.gtf>
    ```
4. Evaluate - Run the evaluation script `evaluate.sh` provided to get recall and precision for a given ground truth file (sorted) and predicted file (sorted). The usage is:
    ```
    ./evaluate.sh <ground-truth-sorted.gtf> <output-sorted.gtf>
    ```

