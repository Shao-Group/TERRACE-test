# Download Data 

The STAR alignments of a set of 10 simulated paired-end RNA-seq samples and 8 biological samples
are available at [doi:10.26208/AZ99-RQ38](https://doi.org/10.26208/AZ99-RQ38).
TERRACE usually take a few minutes to an hour to assemble a typical aligned RNA-seq sample.

# Run TERRACE

The usage of `TERRACE` is:
```
terrace -i <input.bam> -o <output.gtf> -fa <reference-genome.fa> --read_length <length-of-paired-end-reads> -r [reference_annotation.gtf] -fe [feature_file] [options]
```

The `input.bam` is the read alignment file.
```
The reconstructed circular transcripts shall be written as GTF format into `output.gtf`.

`reference-genome.fa` is the reference genome file in fasta format. We recommended to use Gencode GRCh38 (https://www.gencodegenes.org/human/release_38.html) for simulated data and GRCh37 (https://www.gencodegenes.org/human/release_37lift37.html) for biological data for reproducibility of results.

`length-of-paired-end-reads` is the length of the reads used to produce the alignment file (100 for simulated data, 150 for biological data).

`reference_annotation.gtf` is the annotation file in GTF format. This parameter is optional.

`feature_file` is an optional csv file generated by TERRACE that contains circRNA features used in a machine learning model for assigning confidence scores.

# Evaluate TERRACE

1. Download - Download the appropriate ground truth file to evaluate output.gtf produced by TERRACE. The ground truth files for simulated data can be downloaded from [doi:10.26208/AZ99-RQ38](https://doi.org/10.26208/AZ99-RQ38). The ground truth files for simulated data are already in the standard gtf format. Ignore step 2 if you are evaluating on the simulated data. The ground truth files for the biological data can be downloaded from the isocirc catalog (https://genome.ucsc.edu/s/xinglab_chop/isoCirc). See step 2 to convert the biological ground truth to a standard gtf format adjusted for our evaluation pipeline.

2. Convert - (Ignore this step if you are evaluating on simulated data) Convert the biological ground truth file to a standard gtf file adjusted for our evaluation pipeline using the script `convert_isocirc_gtf.py` provided. The usage is:
    ```
    convert_isocirc_gtf.py <dowloaded-ground-truth.gtf> <ground-truth-adjusted.gtf>
    ```

3. Sort - Sort both output.gtf and ground-truth.gtf using `sort_circ_gtf.py` script provided. The usage is:
    ```
    sort_circ_gtf.py <input-file.gtf> <input-file-sorted.gtf>
    ```
4. Evaluate - Run the evaluation script `evaluate.sh` provided to get recall and precision for a given ground truth file (sorted) and predicted file (sorted). The usage is:
    ```
    evaluate.sh <ground-truth-sorted.gtf> <output-sorted.gtf>
    ```

